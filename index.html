<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FFUN Recon – Page 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 16px;
    }
    h1 {
      text-align: center;
    }
    .section {
      background: white;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 8px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
    }
    label {
      font-size: 14px;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    .item {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      align-items: center;
      gap: 12px;
      margin: 6px 0;
    }
    .item span {
      font-size: 14px;
    }
    button {
      width: 100%;
      padding: 18px;
      font-size: 18px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>FFUN Recon – Page 1</h1>

<div class="section">
  <h3>Vehicle Info</h3>
  <div class="grid">
    <label>VIN <input id="vin" type="text"></label>
    <label>Odometer <input id="odometer" type="text"></label>
    <label>Stock # <input id="stock_number" type="text"></label>
    <label>Year <input id="year" type="text"></label>
    <label>Make <input id="make" type="text"></label>
    <label>Model <input id="model" type="text"></label>
    <label>Colour <input id="colour" type="text"></label>
    <label>Engine Type <input id="engine_type" type="text"></label>
    <label>Transmission <input id="transmission_type" type="text"></label>
    <label>FFUN / Value <input id="inspection_type" type="text"></label>
    <label>Technician <input id="tech_name" type="text"></label>
  </div>
</div>

<div class="section">
  <h3>Driver’s Compartment</h3>

  <div class="item" data-field="dc_wipers">
    <span>Windshield wipers & washers</span>
    <label><input type="radio" name="dc_wipers" value="pass"> Pass</label>
    <label><input type="radio" name="dc_wipers" value="note"> Note</label>
    <label><input type="radio" name="dc_wipers" value="fail"> Fail</label>
  </div>

  <div class="item" data-field="dc_defrosters">
    <span>Defrosters & heaters</span>
    <label><input type="radio" name="dc_defrosters" value="pass"> Pass</label>
    <label><input type="radio" name="dc_defrosters" value="note"> Note</label>
    <label><input type="radio" name="dc_defrosters" value="fail"> Fail</label>
  </div>

  <div class="item" data-field="dc_glass">
    <span>Glass</span>
    <label><input type="radio" name="dc_glass" value="pass"> Pass</label>
    <label><input type="radio" name="dc_glass" value="note"> Note</label>
    <label><input type="radio" name="dc_glass" value="fail"> Fail</label>
  </div>

  <div class="item" data-field="dc_horn">
    <span>Horn</span>
    <label><input type="radio" name="dc_horn" value="pass"> Pass</label>
    <label><input type="radio" name="dc_horn" value="note"> Note</label>
    <label><input type="radio" name="dc_horn" value="fail"> Fail</label>
  </div>

</div>

<div class="section">
  <h3>Future Attention Required</h3>
  <textarea id="future_attention" rows="6"></textarea>
</div>

<button onclick="submitForm()">Save & Download PDF</button>

<script>
async function submitForm() {
  try {
    const data = {};

    // Collect text inputs & textarea
    document.querySelectorAll("input[type=text], textarea").forEach(el => {
      data[el.id] = el.value.trim();
    });

    // Collect pass/note/fail radio selections
    document.querySelectorAll(".item").forEach(item => {
      const field = item.dataset.field;
      const selected = item.querySelector("input:checked");
      data[field] = selected ? selected.value : "";
    });

    // Call Flask backend
    const response = await fetch("https://recon-form-pdf-backend.onrender.com/generate-pdf", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    if (!response.ok) {
      throw new Error("PDF generation failed: " + response.statusText);
    }

    // Convert response to blob & trigger download
    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;

    const filename = `FFUN_Recon_${data.vin || "UNKNOWN"}_${data.tech_name || "TECH"}.pdf`;
    a.download = filename;

    document.body.appendChild(a);
    a.click();
    a.remove();
    window.URL.revokeObjectURL(url);
  } catch (err) {
    console.error(err);
    alert("Failed to generate PDF. Make sure the backend is live.");
  }
}
</script>

</body>
</html>
