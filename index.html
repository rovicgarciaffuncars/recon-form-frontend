<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FFUN Recon – Page 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 16px;
    }
    h1 {
      text-align: center;
    }
    .section {
      background: white;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 8px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
    }
    label {
      font-size: 14px;
    }
    input[type="text"], textarea, input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    .item {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      align-items: center;
      gap: 12px;
      margin: 6px 0;
    }
    .item span {
      font-size: 14px;
    }
    .actions {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }
    button {
      flex: 1;
      padding: 18px;
      font-size: 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button.secondary {
      background: #6b7280;
    }
  </style>
</head>
<body>

<h1>FFUN Recon – Page 1</h1>

<div class="section">
  <h3>Vehicle Info</h3>
  <div class="grid">
    <label>VIN * <input id="vin" type="text" required></label>
    <label>Odometer * <input id="odometer" type="text" required></label>
    <label>Stock # <input id="stock_number" type="text"></label>
    <label>Inspection Date <input id="inspection_date" type="date"></label>
    <label>Year <input id="year" type="text"></label>
    <label>Make <input id="make" type="text"></label>
    <label>Model <input id="model" type="text"></label>
    <label>Colour <input id="colour" type="text"></label>
    <label>Engine Type <input id="engine_type" type="text"></label>
    <label>Transmission <input id="transmission_type" type="text"></label>
    <label>FFUN / Value <input id="inspection_type" type="text"></label>
    <label>Technician * <input id="tech_name" type="text" required></label>
  </div>
</div>

<div class="section">
  <h3>Driver’s Compartment</h3>

  <div class="actions">
    <button class="secondary" onclick="passAll('dc')">Pass All</button>
  </div>

  <div class="item" data-field="dc_wipers">
    <span>Windshield wipers & washers</span>
    <label><input type="radio" name="dc_wipers" value="Pass"> Pass</label>
    <label><input type="radio" name="dc_wipers" value="Note"> Note</label>
    <label><input type="radio" name="dc_wipers" value="Fail"> Fail</label>
  </div>

  <div class="item" data-field="dc_defrosters">
    <span>Defrosters & heaters</span>
    <label><input type="radio" name="dc_defrosters" value="Pass"> Pass</label>
    <label><input type="radio" name="dc_defrosters" value="Note"> Note</label>
    <label><input type="radio" name="dc_defrosters" value="Fail"> Fail</label>
  </div>

  <div class="item" data-field="dc_glass">
    <span>Glass</span>
    <label><input type="radio" name="dc_glass" value="Pass"> Pass</label>
    <label><input type="radio" name="dc_glass" value="Note"> Note</label>
    <label><input type="radio" name="dc_glass" value="Fail"> Fail</label>
  </div>

  <div class="item" data-field="dc_horn">
    <span>Horn</span>
    <label><input type="radio" name="dc_horn" value="Pass"> Pass</label>
    <label><input type="radio" name="dc_horn" value="Note"> Note</label>
    <label><input type="radio" name="dc_horn" value="Fail"> Fail</label>
  </div>
</div>

<div class="section">
  <h3>Future Attention Required</h3>
  <textarea id="future_attention" rows="6"></textarea>
</div>

<button onclick="submitForm()">Save & Download PDF</button>

<script>
/* Auto-fill today’s date */
document.getElementById("inspection_date").value =
  new Date().toISOString().split("T")[0];

/* Pass All for a section */
function passAll(prefix) {
  document.querySelectorAll(`input[name^="${prefix}_"][value="Pass"]`)
    .forEach(radio => radio.checked = true);
}

async function submitForm() {
  try {
    const required = ["vin", "odometer", "tech_name"];
    for (const id of required) {
      if (!document.getElementById(id).value.trim()) {
        alert("Please fill all required fields.");
        return;
      }
    }

    const data = {};

    document.querySelectorAll("input[type=text], input[type=date], textarea")
      .forEach(el => data[el.id] = el.value.trim());

    document.querySelectorAll(".item").forEach(item => {
      const field = item.dataset.field;
      const selected = item.querySelector("input:checked");
      data[field] = selected ? selected.value : "Not Checked";
    });

    const response = await fetch(
      "https://recon-form-pdf-backend.onrender.com/generate-pdf",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }
    );

    if (!response.ok) throw new Error("PDF failed");

    const blob = await response.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");

    a.href = url;
    a.download = `FFUN_Recon_${data.vin}_${data.tech_name}.pdf`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);

    /* Reset for next car */
    document.querySelectorAll("input, textarea").forEach(el => {
      if (el.type === "radio") el.checked = false;
      else el.value = "";
    });

    document.getElementById("inspection_date").value =
      new Date().toISOString().split("T")[0];

  } catch (err) {
    console.error(err);
    alert("Failed to generate PDF. Backend may be offline.");
  }
}
</script>

</body>
</html>
